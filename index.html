<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>DA42 Weight & Balance Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root {
    --primary-color: #0078D4;
    --bg-color: #f4f7f9;
    --card-bg: #ffffff;
    --text-main: #1a1a1a;
    --text-sub: #666666;
    
    /* PDF再現用の色 */
    --input-bg: #fffde7; /* 黄色っぽい背景（入力用） */
    --calc-bg: #e3f2fd;  /* 青っぽい背景（計算結果用） */
    --border-color: #ccc;
    --alert-color: #d32f2f;
    --safe-color: #388e3c;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
    background: var(--bg-color);
    margin: 0;
    padding: 20px;
    color: var(--text-main);
    line-height: 1.5;
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
    background: var(--card-bg);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  }

  header {
    margin-bottom: 30px;
    border-bottom: 4px solid var(--primary-color);
    padding-bottom: 15px;
  }

  header h1 {
    margin: 0;
    color: var(--primary-color);
    font-size: 24px;
  }

  header p {
    margin: 5px 0 0;
    font-size: 14px;
    color: var(--text-sub);
  }

  /* 入力フォームのスタイル */
  .wb-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    font-size: 14px;
  }

  .wb-table th, .wb-table td {
    border: 1px solid var(--border-color);
    padding: 8px 10px;
    text-align: right;
  }

  .wb-table th {
    background: #f5f5f5;
    color: var(--text-main);
    font-weight: bold;
    text-align: center;
  }

  .wb-table th.left-align {
    text-align: left;
  }

  /* 入力セル（黄色） */
  .input-cell {
    background-color: var(--input-bg);
    width: 100px;
  }

  .input-cell input {
    width: 100%;
    border: none;
    background: transparent;
    text-align: right;
    font-size: 14px;
    font-weight: bold;
    outline: none;
  }
  
  .input-cell input:focus {
    border-bottom: 2px solid var(--primary-color);
  }

  /* 計算結果セル（青色） */
  .calc-cell {
    background-color: var(--calc-bg);
    font-weight: bold;
    color: #0277bd;
  }

  /* 固定テキストセル */
  .fixed-cell {
    background-color: #fafafa;
    color: #666;
  }

  /* セクション区切り */
  .section-row td {
    background-color: #eceff1;
    font-weight: bold;
    text-align: left;
    padding-left: 15px;
    color: var(--text-main);
  }

  /* 結果表示エリア */
  .result-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 30px;
  }

  .result-card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
  }

  .result-card h3 {
    margin: 0 0 10px;
    font-size: 14px;
    color: var(--text-sub);
  }

  .result-card .value {
    font-size: 24px;
    font-weight: bold;
    display: block;
  }

  .status-ok { color: var(--safe-color); }
  .status-alert { color: var(--alert-color); }

  .disclaimer {
    margin-top: 40px;
    padding: 15px;
    background-color: #ffebee;
    color: #c62828;
    border-radius: 6px;
    font-size: 12px;
    font-weight: bold;
    text-align: center;
  }

  /* Print/Mobile adjustments */
  @media (max-width: 600px) {
    .container { padding: 15px; }
    .wb-table { font-size: 12px; }
    .wb-table th, .wb-table td { padding: 5px; }
    .input-cell input { font-size: 12px; }
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>DA42 Weight & Balance</h1>
    <p>JA224T Load Sheet Calculation</p>
  </header>

  <form id="wbForm">
    <table class="wb-table">
      <thead>
        <tr>
          <th class="left-align">Position</th>
          <th>Qty<br>(gal)</th>
          <th>Weight<br>(lbs)</th>
          <th>Arm<br>(in)</th>
          <th>Moment<br>(in·lbs)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="left-align">Basic Empty Weight</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="bew_weight" value="3150.4" step="0.1"></td>
          <td class="input-cell"><input type="number" id="bew_arm" value="94.7" step="0.01"></td>
          <td class="calc-cell" id="bew_mom">0</td>
        </tr>
        
        <tr>
          <td class="left-align">Pilot</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="pilot_weight" placeholder="0"></td>
          <td class="fixed-cell">90.6</td>
          <td class="calc-cell" id="pilot_mom">0</td>
        </tr>
        <tr>
          <td class="left-align">Front Passenger</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="pax_front_weight" placeholder="0"></td>
          <td class="fixed-cell">90.6</td>
          <td class="calc-cell" id="pax_front_mom">0</td>
        </tr>
        <tr>
          <td class="left-align">Rear Passenger 1</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="pax_rear1_weight" placeholder="0"></td>
          <td class="fixed-cell">128.0</td>
          <td class="calc-cell" id="pax_rear1_mom">0</td>
        </tr>
        <tr>
          <td class="left-align">Rear Passenger 2</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="pax_rear2_weight" placeholder="0"></td>
          <td class="fixed-cell">128.0</td>
          <td class="calc-cell" id="pax_rear2_mom">0</td>
        </tr>
        <tr>
          <td class="left-align">Cargo Nose</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="cargo_nose_weight" placeholder="0"></td>
          <td class="fixed-cell">23.6</td>
          <td class="calc-cell" id="cargo_nose_mom">0</td>
        </tr>
        <tr>
          <td class="left-align">Cargo Cabin</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="cargo_cabin_weight" placeholder="0"></td>
          <td class="fixed-cell">153.1</td>
          <td class="calc-cell" id="cargo_cabin_mom">0</td>
        </tr>
        <tr>
          <td class="left-align">Cargo Extend</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="cargo_extend_weight" placeholder="0"></td>
          <td class="fixed-cell">178.7</td>
          <td class="calc-cell" id="cargo_extend_mom">0</td>
        </tr>
        <tr>
          <td class="left-align">De-ice Fluid</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="deice_weight" placeholder="lbs"></td>
          <td class="fixed-cell">39.4</td>
          <td class="calc-cell" id="deice_mom">0</td>
        </tr>

        <tr class="section-row">
          <td colspan="2">Zero Fuel Condition</td>
          <td class="calc-cell" id="zfw_weight">0</td>
          <td class="calc-cell" id="zfw_cg">0</td>
          <td class="calc-cell" id="zfw_mom">0</td>
        </tr>

        <tr>
          <td class="left-align">Main Fuel on Board</td>
          <td class="input-cell"><input type="number" id="fuel_main_gal" placeholder="gal"></td>
          <td class="calc-cell" id="fuel_main_weight">0</td>
          <td class="fixed-cell">103.5</td>
          <td class="calc-cell" id="fuel_main_mom">0</td>
        </tr>
        <tr>
          <td class="left-align">AUX Fuel</td>
          <td class="input-cell"><input type="number" id="fuel_aux_gal" placeholder="0" value="0"></td>
          <td class="calc-cell" id="fuel_aux_weight">0</td>
          <td class="fixed-cell">126.0</td>
          <td class="calc-cell" id="fuel_aux_mom">0</td>
        </tr>
        <tr>
          <td class="left-align">Runup/Taxi Burn off</td>
          <td class="fixed-cell">-1.0</td>
          <td class="fixed-cell">-7.01</td>
          <td class="fixed-cell">103.5</td>
          <td class="fixed-cell">-726</td>
        </tr>

        <tr class="section-row">
          <td colspan="2">Takeoff Condition</td>
          <td class="calc-cell" id="tow_weight">0</td>
          <td class="calc-cell" id="tow_cg">0</td>
          <td class="calc-cell" id="tow_mom">0</td>
        </tr>

        <tr>
          <td class="left-align">Trip Fuel</td>
          <td class="input-cell"><input type="number" id="trip_fuel_gal" placeholder="gal"></td>
          <td class="calc-cell" id="trip_fuel_weight">0</td>
          <td class="fixed-cell">103.5</td>
          <td class="calc-cell" id="trip_fuel_mom">0</td>
        </tr>

        <tr class="section-row">
          <td colspan="2">Landing Condition</td>
          <td class="calc-cell" id="ldg_weight">0</td>
          <td class="calc-cell" id="ldg_cg">0</td>
          <td class="calc-cell" id="ldg_mom">0</td>
        </tr>

      </tbody>
    </table>
  </form>

  <div class="result-summary">
    <div class="result-card">
      <h3>Takeoff Weight</h3>
      <span class="value" id="res_tow">0 lbs</span>
      <span id="res_tow_status" class="status-ok">Within Limits</span>
      <small>Max: 4189 lbs</small>
    </div>
    <div class="result-card">
      <h3>Landing Weight</h3>
      <span class="value" id="res_ldg">0 lbs</span>
      <span id="res_ldg_status" class="status-ok">Within Limits</span>
      <small>Max: 3979 lbs</small>
    </div>
    <div class="result-card">
      <h3>Takeoff C.G.</h3>
      <span class="value" id="res_cg">0 in</span>
      <small>Check Envelope</small>
    </div>
  </div>

  <div class="disclaimer">
    ⚠️ WARNING: THIS TOOL IS FOR REFERENCE ONLY. <br>
    ALWAYS REFER TO THE OFFICIAL POH AND AIRCRAFT DOCUMENTS FOR FLIGHT OPERATIONS.
  </div>
</div>

<script>
  [cite_start]// Fixed Constants [cite: 232]
  const ARMS = {
    pilot: 90.6,
    frontPax: 90.6,
    rearPax: 128.0,
    cargoNose: 23.6,
    cargoCabin: 153.1,
    cargoExtend: 178.7,
    deice: 39.4,
    fuelMain: 103.5,
    fuelAux: 126.0
  };

  const FUEL_DENSITY = 7.01; [cite_start]// lbs/gal [cite: 232]
  
  [cite_start]// Limits [cite: 233]
  const LIMITS = {
    maxTOW: 4189,
    maxLDG: 3979
  };

  [cite_start]// Fixed Taxi Burn [cite: 232]
  const TAXI = {
    weight: -7.01,
    moment: -726
  };

  function getVal(id) {
    return parseFloat(document.getElementById(id).value) || 0;
  }

  function setHtml(id, val, isFloat = true) {
    document.getElementById(id).innerText = isFloat ? val.toFixed(1) : val.toFixed(0);
  }

  function calculate() {
    // 1. Inputs
    const bewWeight = getVal('bew_weight');
    const bewArm = getVal('bew_arm');
    
    // Payload Weights
    const w = {
      pilot: getVal('pilot_weight'),
      front: getVal('pax_front_weight'),
      rear1: getVal('pax_rear1_weight'),
      rear2: getVal('pax_rear2_weight'),
      nose: getVal('cargo_nose_weight'),
      cabin: getVal('cargo_cabin_weight'),
      extend: getVal('cargo_extend_weight'),
      deice: getVal('deice_weight')
    };

    // Fuel Inputs (Gallons -> Lbs)
    const galMain = getVal('fuel_main_gal');
    const galAux = getVal('fuel_aux_gal');
    const galTrip = getVal('trip_fuel_gal');

    const wFuel = {
      main: galMain * FUEL_DENSITY,
      aux: galAux * FUEL_DENSITY,
      trip: galTrip * FUEL_DENSITY * -1 // Subtracted for Landing
    };

    // 2. Calculation: Moments
    const momBEW = bewWeight * bewArm;
    const m = {
      pilot: w.pilot * ARMS.pilot,
      front: w.front * ARMS.frontPax,
      rear1: w.rear1 * ARMS.rearPax,
      rear2: w.rear2 * ARMS.rearPax,
      nose: w.nose * ARMS.cargoNose,
      cabin: w.cabin * ARMS.cargoCabin,
      extend: w.extend * ARMS.cargoExtend,
      deice: w.deice * ARMS.deice,
      fuelMain: wFuel.main * ARMS.fuelMain,
      fuelAux: wFuel.aux * ARMS.fuelAux,
      trip: wFuel.trip * ARMS.fuelMain // Trip fuel burns from Main tanks
    };

    // Update Fuel Weight/Moment Cells
    setHtml('fuel_main_weight', wFuel.main);
    setHtml('fuel_main_mom', m.fuelMain, false);
    setHtml('fuel_aux_weight', wFuel.aux);
    setHtml('fuel_aux_mom', m.fuelAux, false);
    setHtml('trip_fuel_weight', wFuel.trip); // will show negative
    setHtml('trip_fuel_mom', m.trip, false);

    // Update Payload Moment Cells
    setHtml('bew_mom', momBEW, false);
    setHtml('pilot_mom', m.pilot, false);
    setHtml('pax_front_mom', m.front, false);
    setHtml('pax_rear1_mom', m.rear1, false);
    setHtml('pax_rear2_mom', m.rear2, false);
    setHtml('cargo_nose_mom', m.nose, false);
    setHtml('cargo_cabin_mom', m.cabin, false);
    setHtml('cargo_extend_mom', m.extend, false);
    setHtml('deice_mom', m.deice, false);

    // 3. Subtotals
    
    // Zero Fuel Weight (ZFW)
    const zfwWeight = bewWeight + w.pilot + w.front + w.rear1 + w.rear2 + w.nose + w.cabin + w.extend + w.deice;
    const zfwMom = momBEW + m.pilot + m.front + m.rear1 + m.rear2 + m.nose + m.cabin + m.extend + m.deice;
    const zfwCG = zfwWeight > 0 ? zfwMom / zfwWeight : 0;

    setHtml('zfw_weight', zfwWeight);
    setHtml('zfw_mom', zfwMom, false);
    setHtml('zfw_cg', zfwCG, true); // Display CG to 2 decimals usually, sticking to 1 for consistency or 2 for precision? PDF uses 2.
    document.getElementById('zfw_cg').innerText = zfwCG.toFixed(2);

    // Takeoff Weight (TOW) = ZFW + Fuel - Taxi
    const towWeight = zfwWeight + wFuel.main + wFuel.aux + TAXI.weight;
    const towMom = zfwMom + m.fuelMain + m.fuelAux + TAXI.moment;
    const towCG = towWeight > 0 ? towMom / towWeight : 0;

    setHtml('tow_weight', towWeight);
    setHtml('tow_mom', towMom, false);
    document.getElementById('tow_cg').innerText = towCG.toFixed(2);

    // Landing Weight (LDG) = TOW - Trip Fuel
    const ldgWeight = towWeight + wFuel.trip; // wFuel.trip is negative
    const ldgMom = towMom + m.trip;
    const ldgCG = ldgWeight > 0 ? ldgMom / ldgWeight : 0;

    setHtml('ldg_weight', ldgWeight);
    setHtml('ldg_mom', ldgMom, false);
    document.getElementById('ldg_cg').innerText = ldgCG.toFixed(2);

    // 4. Update Result Cards & Validation
    document.getElementById('res_tow').innerText = towWeight.toFixed(1) + " lbs";
    document.getElementById('res_ldg').innerText = ldgWeight.toFixed(1) + " lbs";
    document.getElementById('res_cg').innerText = towCG.toFixed(2) + " in";

    // Validate Takeoff Weight
    const towStatus = document.getElementById('res_tow_status');
    if (towWeight > LIMITS.maxTOW) {
        towStatus.innerText = "OVER MAX WEIGHT!";
        towStatus.className = "status-alert";
        document.getElementById('tow_weight').style.color = "red";
    } else {
        towStatus.innerText = "Within Limits";
        towStatus.className = "status-ok";
        document.getElementById('tow_weight').style.color = "#0277bd";
    }

    // Validate Landing Weight
    const ldgStatus = document.getElementById('res_ldg_status');
    if (ldgWeight > LIMITS.maxLDG) {
        ldgStatus.innerText = "OVER MAX WEIGHT!";
        ldgStatus.className = "status-alert";
        document.getElementById('ldg_weight').style.color = "red";
    } else {
        ldgStatus.innerText = "Within Limits";
        ldgStatus.className = "status-ok";
        document.getElementById('ldg_weight').style.color = "#0277bd";
    }
  }

  // Add event listeners to all inputs
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => {
    input.addEventListener('input', calculate);
  });

  // Initial Calculation
  calculate();
</script>

</body>
</html>
