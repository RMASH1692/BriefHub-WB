<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>DA42 Weight & Balance Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root {
    --primary-color: #0078D4;
    --bg-color: #f4f7f9;
    --card-bg: #ffffff;
    --text-main: #1a1a1a;
    --text-sub: #666666;
    
    /* 色設定 */
    --input-bg: #fff9c4; /* 入力欄：明るい黄色 */
    --calc-bg: #ffffff;  /* 計算結果：白（変更箇所） */
    --border-color: #ddd;
    --alert-color: #d32f2f;
    --safe-color: #388e3c;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
    background: var(--bg-color);
    margin: 0;
    padding: 20px;
    color: var(--text-main);
    line-height: 1.5;
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
    background: var(--card-bg);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  }

  header {
    margin-bottom: 25px;
    border-bottom: 3px solid var(--primary-color);
    padding-bottom: 10px;
  }

  header h1 {
    margin: 0;
    color: var(--primary-color);
    font-size: 22px;
  }

  header p {
    margin: 5px 0 0;
    font-size: 13px;
    color: var(--text-sub);
  }

  /* テーブルスタイル */
  .wb-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
    font-size: 14px;
  }

  .wb-table th, .wb-table td {
    border: 1px solid var(--border-color);
    padding: 10px 12px;
    text-align: right;
    vertical-align: middle;
  }

  .wb-table th {
    background: #f0f0f0;
    color: #333;
    font-weight: bold;
    text-align: center;
  }

  .wb-table th.left-align {
    text-align: left;
  }

  /* 入力セル（黄色） */
  .input-cell {
    background-color: var(--input-bg);
    width: 100px;
    padding: 0; /* paddingを0にしてinputを広げる */
  }

  .input-cell input {
    width: 100%;
    height: 100%;
    border: none;
    background: transparent;
    text-align: right;
    font-size: 15px;
    font-weight: bold;
    color: #000;
    padding: 10px 12px; /* tdのpaddingに合わせる */
    box-sizing: border-box;
    outline: none;
  }
  
  .input-cell input:focus {
    background-color: #fff59d; /* フォーカス時に少し濃く */
  }
  
  .input-cell input::placeholder {
    color: #aaa;
    font-weight: normal;
  }

  /* 計算結果セル（白背景・太字） */
  .calc-cell {
    background-color: var(--calc-bg);
    font-weight: bold;
    color: var(--text-main);
  }

  /* 固定テキストセル */
  .fixed-cell {
    background-color: #fafafa;
    color: #666;
  }

  /* 小計・合計行 */
  .section-row td {
    background-color: #f5f5f5;
    font-weight: bold;
    color: #333;
    border-top: 2px solid #aaa;
  }
  
  /* 左寄せテキスト */
  .left-text {
    text-align: left !important;
  }

  /* 結果表示カードエリア */
  .result-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 30px;
  }

  .result-card {
    background: #fff;
    border: 1px solid #ddd;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  .result-card h3 {
    margin: 0 0 10px;
    font-size: 14px;
    color: #555;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .result-card .value {
    font-size: 28px;
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
  }

  .status-ok { 
    color: var(--safe-color); 
    font-weight: bold;
    font-size: 14px;
  }
  .status-alert { 
    color: var(--alert-color); 
    font-weight: bold;
    font-size: 14px;
  }

  /* スマホ対応 */
  @media (max-width: 600px) {
    .container { padding: 15px; }
    .wb-table { font-size: 12px; }
    .wb-table th, .wb-table td { padding: 6px 4px; }
    .input-cell input { font-size: 13px; padding: 6px 4px; }
    .result-card .value { font-size: 22px; }
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>DA42 Weight & Balance</h1>
    <p>JA224T Load Sheet Calculation</p>
  </header>

  <form id="wbForm" onsubmit="return false;">
    <table class="wb-table">
      <thead>
        <tr>
          <th class="left-align">Position</th>
          <th style="width: 60px;">Qty<br>(gal)</th>
          <th style="width: 90px;">Weight<br>(lbs)</th>
          <th style="width: 70px;">Arm<br>(in)</th>
          <th>Moment<br>(in·lbs)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="left-text">Basic Empty Weight</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="bew_weight" value="3150.4" step="0.1"></td>
          <td class="input-cell"><input type="number" id="bew_arm" value="94.7" step="0.01"></td>
          <td class="calc-cell" id="bew_mom">0</td>
        </tr>
        
        <tr>
          <td class="left-text">Pilot</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="pilot_weight" placeholder="0"></td>
          <td class="fixed-cell">90.6</td>
          <td class="calc-cell" id="pilot_mom">0</td>
        </tr>
        <tr>
          <td class="left-text">Front Passenger</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="pax_front_weight" placeholder="0"></td>
          <td class="fixed-cell">90.6</td>
          <td class="calc-cell" id="pax_front_mom">0</td>
        </tr>
        <tr>
          <td class="left-text">Rear Passenger 1</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="pax_rear1_weight" placeholder="0"></td>
          <td class="fixed-cell">128.0</td>
          <td class="calc-cell" id="pax_rear1_mom">0</td>
        </tr>
        <tr>
          <td class="left-text">Rear Passenger 2</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="pax_rear2_weight" placeholder="0"></td>
          <td class="fixed-cell">128.0</td>
          <td class="calc-cell" id="pax_rear2_mom">0</td>
        </tr>
        <tr>
          <td class="left-text">Cargo Nose</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="cargo_nose_weight" placeholder="0"></td>
          <td class="fixed-cell">23.6</td>
          <td class="calc-cell" id="cargo_nose_mom">0</td>
        </tr>
        <tr>
          <td class="left-text">Cargo Cabin</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="cargo_cabin_weight" placeholder="0"></td>
          <td class="fixed-cell">153.1</td>
          <td class="calc-cell" id="cargo_cabin_mom">0</td>
        </tr>
        <tr>
          <td class="left-text">Cargo Extend</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="cargo_extend_weight" placeholder="0"></td>
          <td class="fixed-cell">178.7</td>
          <td class="calc-cell" id="cargo_extend_mom">0</td>
        </tr>
        <tr>
          <td class="left-text">De-ice Fluid</td>
          <td>-</td>
          <td class="input-cell"><input type="number" id="deice_weight" placeholder="lbs"></td>
          <td class="fixed-cell">39.4</td>
          <td class="calc-cell" id="deice_mom">0</td>
        </tr>

        <tr class="section-row">
          <td colspan="2" class="left-text">Zero Fuel Condition</td>
          <td class="calc-cell" id="zfw_weight">0</td>
          <td class="calc-cell" id="zfw_cg">0</td>
          <td class="calc-cell" id="zfw_mom">0</td>
        </tr>

        <tr>
          <td class="left-text">Main Fuel on Board</td>
          <td class="input-cell"><input type="number" id="fuel_main_gal" placeholder="gal"></td>
          <td class="calc-cell" id="fuel_main_weight">0</td>
          <td class="fixed-cell">103.5</td>
          <td class="calc-cell" id="fuel_main_mom">0</td>
        </tr>
        <tr>
          <td class="left-text">AUX Fuel</td>
          <td class="input-cell"><input type="number" id="fuel_aux_gal" placeholder="0" value="0"></td>
          <td class="calc-cell" id="fuel_aux_weight">0</td>
          <td class="fixed-cell">126.0</td>
          <td class="calc-cell" id="fuel_aux_mom">0</td>
        </tr>
        <tr>
          <td class="left-text">Runup/Taxi Burn off</td>
          <td class="fixed-cell">-1.0</td>
          <td class="fixed-cell">-7.01</td>
          <td class="fixed-cell">103.5</td>
          <td class="fixed-cell">-726</td>
        </tr>

        <tr class="section-row">
          <td colspan="2" class="left-text">Takeoff Condition</td>
          <td class="calc-cell" id="tow_weight">0</td>
          <td class="calc-cell" id="tow_cg">0</td>
          <td class="calc-cell" id="tow_mom">0</td>
        </tr>

        <tr>
          <td class="left-text">Trip Fuel</td>
          <td class="input-cell"><input type="number" id="trip_fuel_gal" placeholder="gal"></td>
          <td class="calc-cell" id="trip_fuel_weight">0</td>
          <td class="fixed-cell">103.5</td>
          <td class="calc-cell" id="trip_fuel_mom">0</td>
        </tr>

        <tr class="section-row">
          <td colspan="2" class="left-text">Landing Condition</td>
          <td class="calc-cell" id="ldg_weight">0</td>
          <td class="calc-cell" id="ldg_cg">0</td>
          <td class="calc-cell" id="ldg_mom">0</td>
        </tr>

      </tbody>
    </table>
  </form>

  <div class="result-summary">
    <div class="result-card">
      <h3>Takeoff Weight</h3>
      <span class="value" id="res_tow">0 lbs</span>
      <span id="res_tow_status" class="status-ok">Within Limits</span>
      <div style="font-size:12px; color:#888; margin-top:5px;">Max: 4189 lbs</div>
    </div>
    <div class="result-card">
      <h3>Landing Weight</h3>
      <span class="value" id="res_ldg">0 lbs</span>
      <span id="res_ldg_status" class="status-ok">Within Limits</span>
      <div style="font-size:12px; color:#888; margin-top:5px;">Max: 3979 lbs</div>
    </div>
    <div class="result-card">
      <h3>Takeoff C.G.</h3>
      <span class="value" id="res_cg">0 in</span>
      <div style="font-size:12px; color:#888; margin-top:5px;">Check Envelope</div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Constants
  const ARMS = {
    pilot: 90.6,
    frontPax: 90.6,
    rearPax: 128.0,
    cargoNose: 23.6,
    cargoCabin: 153.1,
    cargoExtend: 178.7,
    deice: 39.4,
    fuelMain: 103.5,
    fuelAux: 126.0
  };
  const FUEL_DENSITY = 7.01; 
  const LIMITS = { maxTOW: 4189, maxLDG: 3979 };
  const TAXI = { weight: -7.01, moment: -726 };

  // Helper Functions
  function getVal(id) {
    const val = parseFloat(document.getElementById(id).value);
    return isNaN(val) ? 0 : val;
  }

  function setHtml(id, val, decimals = 0) {
    const el = document.getElementById(id);
    if(el) el.innerText = val.toFixed(decimals);
  }

  function calculate() {
    // 1. Get Inputs
    const bewWeight = getVal('bew_weight');
    const bewArm = getVal('bew_arm');
    
    const w = {
      pilot: getVal('pilot_weight'),
      front: getVal('pax_front_weight'),
      rear1: getVal('pax_rear1_weight'),
      rear2: getVal('pax_rear2_weight'),
      nose: getVal('cargo_nose_weight'),
      cabin: getVal('cargo_cabin_weight'),
      extend: getVal('cargo_extend_weight'),
      deice: getVal('deice_weight')
    };

    const galMain = getVal('fuel_main_gal');
    const galAux = getVal('fuel_aux_gal');
    const galTrip = getVal('trip_fuel_gal');

    const wFuel = {
      main: galMain * FUEL_DENSITY,
      aux: galAux * FUEL_DENSITY,
      trip: galTrip * FUEL_DENSITY * -1 // Burned fuel (negative weight)
    };

    // 2. Calculate Moments
    const momBEW = bewWeight * bewArm;
    const m = {
      pilot: w.pilot * ARMS.pilot,
      front: w.front * ARMS.frontPax,
      rear1: w.rear1 * ARMS.rearPax,
      rear2: w.rear2 * ARMS.rearPax,
      nose: w.nose * ARMS.cargoNose,
      cabin: w.cabin * ARMS.cargoCabin,
      extend: w.extend * ARMS.cargoExtend,
      deice: w.deice * ARMS.deice,
      fuelMain: wFuel.main * ARMS.fuelMain,
      fuelAux: wFuel.aux * ARMS.fuelAux,
      trip: wFuel.trip * ARMS.fuelMain
    };

    // Update Display (Moments & Fuel Weights)
    setHtml('bew_mom', momBEW);
    setHtml('pilot_mom', m.pilot);
    setHtml('pax_front_mom', m.front);
    setHtml('pax_rear1_mom', m.rear1);
    setHtml('pax_rear2_mom', m.rear2);
    setHtml('cargo_nose_mom', m.nose);
    setHtml('cargo_cabin_mom', m.cabin);
    setHtml('cargo_extend_mom', m.extend);
    setHtml('deice_mom', m.deice);

    setHtml('fuel_main_weight', wFuel.main, 1);
    setHtml('fuel_main_mom', m.fuelMain);
    setHtml('fuel_aux_weight', wFuel.aux, 1);
    setHtml('fuel_aux_mom', m.fuelAux);
    setHtml('trip_fuel_weight', wFuel.trip, 1);
    setHtml('trip_fuel_mom', m.trip);

    // 3. Subtotals
    // Zero Fuel Weight
    const zfwWeight = bewWeight + w.pilot + w.front + w.rear1 + w.rear2 + w.nose + w.cabin + w.extend + w.deice;
    const zfwMom = momBEW + m.pilot + m.front + m.rear1 + m.rear2 + m.nose + m.cabin + m.extend + m.deice;
    const zfwCG = zfwWeight > 0 ? zfwMom / zfwWeight : 0;

    setHtml('zfw_weight', zfwWeight, 1);
    setHtml('zfw_cg', zfwCG, 2);
    setHtml('zfw_mom', zfwMom);

    // Takeoff Weight
    const towWeight = zfwWeight + wFuel.main + wFuel.aux + TAXI.weight;
    const towMom = zfwMom + m.fuelMain + m.fuelAux + TAXI.moment;
    const towCG = towWeight > 0 ? towMom / towWeight : 0;

    setHtml('tow_weight', towWeight, 1);
    setHtml('tow_cg', towCG, 2);
    setHtml('tow_mom', towMom);

    // Landing Weight
    const ldgWeight = towWeight + wFuel.trip;
    const ldgMom = towMom + m.trip;
    const ldgCG = ldgWeight > 0 ? ldgMom / ldgWeight : 0;

    setHtml('ldg_weight', ldgWeight, 1);
    setHtml('ldg_cg', ldgCG, 2);
    setHtml('ldg_mom', ldgMom);

    // 4. Update Result Cards & Alert Check
    document.getElementById('res_tow').innerText = towWeight.toFixed(1) + " lbs";
    document.getElementById('res_ldg').innerText = ldgWeight.toFixed(1) + " lbs";
    document.getElementById('res_cg').innerText = towCG.toFixed(2) + " in";

    // TOW Alert
    const towStatus = document.getElementById('res_tow_status');
    const towEl = document.getElementById('tow_weight');
    if (towWeight > LIMITS.maxTOW) {
      towStatus.innerText = "OVER MAX WEIGHT!";
      towStatus.className = "status-alert";
      towEl.style.color = "var(--alert-color)";
    } else {
      towStatus.innerText = "Within Limits";
      towStatus.className = "status-ok";
      towEl.style.color = "var(--text-main)";
    }

    // LDG Alert
    const ldgStatus = document.getElementById('res_ldg_status');
    const ldgEl = document.getElementById('ldg_weight');
    if (ldgWeight > LIMITS.maxLDG) {
      ldgStatus.innerText = "OVER MAX WEIGHT!";
      ldgStatus.className = "status-alert";
      ldgEl.style.color = "var(--alert-color)";
    } else {
      ldgStatus.innerText = "Within Limits";
      ldgStatus.className = "status-ok";
      ldgEl.style.color = "var(--text-main)";
    }
  }

  // Bind Events
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => {
    input.addEventListener('input', calculate);
    input.addEventListener('change', calculate); // Ensure changes like arrow keys also trigger
  });

  // Initial Calculation
  calculate();
});
</script>

</body>
</html>
